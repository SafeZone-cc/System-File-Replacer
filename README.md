# System File Replacer

Иногда средство восстановления поврежденных системных файлов SFC не помогает.
В этом случае аналитикам приходится отыскивать оригинальный файл и давать непростую инструкцию для пользователя по его замене.
Этот скрипт облегчит задачу по замене на целевой системе системного файла, предоставленного аналитиком, и убедиться в успехе операции.

## Инструкция для пользователя
1. Скачайте архив. Распакуйте. Запустите файл **SysFileReplacer**.cmd.
2. Отчет в виде файла **Result.txt** предоставьте консультанту (выложите на форуме).

** Не давайте этот скрипт больше никому и не используйте повторно. Это может повредить Вашу или чужую систему.**

## Инструкция для консультанта
1. Скачайте архив. Распакуйте.
2. В папку **Original** положите чистые файлы, например:
- comctl32_x32.dll
- comctl32_x64.dll
3. В файл **CopyScript.txt** внесите записи по образцу, например:
`"Original\comctl32_x64.dll" "C:\Windows\System32\comctl32.dll"`
`"Original\comctl32_x32.dll" "C:\Windows\Syswow64\comctl32.dll"`
(слева в кавычках - откуда копировать, справа - куда)
4. Запакуйте архив, предоставьте его пользователю.

P.S. Если в архив не положить чистые файлы,
то этот скрипт просто выполнит резервное копирование указанных (справа) файлов в папку **Backup**. Поэтому скрипт можно безопасно использовать и с этой целью.

## Поисковый скрипт GetClearFiles.cmd** (для консультанта)

Предназначен для быстрого поиска чистых файлов из Вашей системы и составления скрипта лечения на автомате.

Итак, в папке Original есть еще 2 файла:
- GetClearFiles.cmd
- List.txt

Они позволяют выполнить поиск на Вашей **чистой** системе по списку, указанному в List.txt, файлов в каталоге C:\windows,
а затем скопировать их в папку Original и автоматически подготовить файл CopyScript.txt.
Дальше будет достаточно все упаковать и дать пользователю.

**Будьте внимательны с версией и разрядностью ОС.**
**Автор скрипта не несет ответственности за ущерб, причиненный заменой файлов с неверными или поврежденными версиями.**

## Основной функционал скрипта

- проверка, что запущен в среде надлежащей разрядности (если ОС - x64, то процесс тоже x64)
- создание контрольной точки восстановления системы.
- резервное копирование заменяемых файлов в папку Backup (одноименные файлы будут переименованы (1)(2)...). К оригиналу будет приписано **.bak**
- замена файлов с сохранением исходных прав (владелец будет установлен как TrustedInstaller).
- перерегистрация файла (если это библиотека).
- проверка контрольной суммы после замены
- создание подробного отчета Result.txt

## Отчет Result.txt может выглядеть примерно так:

[Result.txt](https://github.com/SafeZone-cc/System-File-Replacer/files/2212093/Result.txt)